
function edit_basic_data(f,g){var h=new Array();if(f=="add"){var j=new Array();j.push('<tr class="success addRows">');for(var i=0;i<$("#roleList_tab thead tr").find("th").length;i++){if(i==0){j.push('<td style="text-align: center;border:none;" class="tdCenter"><img class="comimg" com_id="" name="" id="" src="manager/images/common/close.png"></td>')}else if(i==1){j.push('<td class="comName" style="border:none;"></td>')}else{j.push('<td class="center" style="border:none;"></td>')}}
j.push('</tr>');$('#roleList_tab tr').removeClass('success');if($('#roleList_tab tbody tr').length==0){$('#roleList_tab tbody').append(j.join(""))}else{$('#roleList_tab tr').eq(1).before(j.join(""))}}
var k=f=='add'?'':$.trim($(g).parent().next().text());var l=f=='add'?'':$.trim($(g).parent().next().next().text());h.push('<tr class="trEditForm_com_'+f+'" style="background:#FFFFFF;">');h.push('    <td colspan="7" style="padding:0;">');h.push('        <div style="height:auto; overflow:auto;">');h.push('        <section id="tabs-simple">');h.push('        <div id="tab_selfs" class="ui-tabs ui-widget ui-widget-content ui-corner-all">');h.push('         <ul id="tab_index_configs" class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"');h.push('         role="tablist">');h.push('             <li class="ui-state-default ui-corner-top ui-tabs-active ui-state-active"');h.push('             role="tab" tabindex="0" aria-controls="tabs-1" aria-labelledby="ui-id-6"');h.push('             aria-selected="true">');h.push('                 <a target="tabs-serviceConfig" class="ui-tabs-anchor" role="presentation"');h.push('                 tabindex="-1" id="ui-id-6">');h.push('                     权限授予');h.push('                 </a>');h.push('             </li>');h.push('             <li class="ui-state-default ui-corner-top" role="tab" tabindex="-1"');h.push('             aria-controls="tabs-equip_param_tb" aria-labelledby="ui-id-1" aria-selected="false">');h.push('                 <a target="tabs-equip_param_tb" class="ui-tabs-anchor" role="presentation"');h.push('                 tabindex="-1" id="ui-id-1">');h.push('                     角色用户关系');h.push('                 </a>');h.push('             </li>');h.push('         </ul>');h.push('         <div id="tabs-serviceConfig" aria-labelledby="ui-id-6" class="ui-tabs-panel ui-widget-content ui-corner-bottom"');h.push('         role="tabpanel" aria-expanded="true" aria-hidden="false" style="display: block;height: auto;">');h.push('             <table width="100%" class="function">');h.push('                <tr>');h.push('                    <td class="titles_td">');h.push('                        角色名：');h.push('                    </td>');h.push('                    <td class="child_td">');h.push('                        <span id="roleName_'+f+'" class="edit-text">'+k+'</span>');h.push('                    </td>');h.push('                    <td class="titles_td">');h.push('                        角色描述：');h.push('                    </td>');h.push('                    <td class="child_td">');h.push('                        <span id="roleDesc_'+f+'" class="edit-text">'+l+'</span>');h.push('                    </td>');h.push('                </tr>');h.push('                <tr>');h.push('                    <td class="titles_td" colspan="4">');h.push('                       <div id="role_functions" class="function_div">');h.push('                         <table width="100%" class="table table-bordered table-striped" id="function_tab">');h.push('                             <tr>');h.push('                          <th width="30%">');h.push('                                     模块名称：');h.push('                                 </th>');h.push('                                 <th>');h.push('                                     权限：');h.push('                                 </th>');h.push('                             </tr>');h.push('                          </table>');h.push('                        </div>');h.push('                    </td>');h.push('                </tr>');h.push('             </table>');h.push('        </div>');h.push('        <div id="tabs-equip_param_tb" aria-labelledby="ui-id-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"');h.push('             role="tabpanel" style="display: none;height:200px;" aria-expanded="false" aria-hidden="true">');h.push('             <table width="100%" class="roleuser">');h.push('                <tr>');h.push('                    <td class="child_td" colspan="4">');h.push('                        <div style="width:44%; margin:3px auto 0;">');h.push('                            <div style="height:150px;width:160px;float:left;"><span>未选用户：</span>');h.push('                                <ul id="noUsed_ul" class="roleUser"></ul>');h.push('                            </div>');h.push('                            <div style="width:50px;float:left;margin-left:40px">');h.push('                                <button id="btn_left_used" class="btn btn-primary" disabled style="width:40px;margin-top:40px;margin-left:5px">></button>');h.push('                                <button id="btn_allLeft_used" class="btn btn-primary" disabled style="width:40px;margin-top:5px;margin-left:5px" >>></button>');h.push('                                <button id="btn_allright_noused" class="btn btn-primary" disabled style="width:40px;margin-top:5px;margin-left:5px" ><<</button>');h.push('                                <button id="btn_right_used" class="btn btn-primary" disabled style="width:40px;margin-top:5px;margin-left:5px" ><</button>');h.push('                            </div>');h.push('                            <div style="height:150px;width:160px;float:left;margin-left:40px;"><span>已选用户：</span>');h.push('                                <ul id="used_ul" class="roleUser"></ul>');h.push('                            </div>');h.push('                        </div>');h.push('                    </td>');h.push('                </tr>');h.push('             </table>');h.push('        </div>');h.push('        </div>');h.push('        </section></div>');h.push('    </td>');h.push('</tr>');h.push('<tr style="background:#FFFFFF;" class="tr_oper_button">');h.push('   <td align="center" colspan="8" style="text-align:right;background:#FFFFFF;border-top:none;">');if(f=='edit'){h.push('      <a id="edit_base_'+f+'" class="btn btn-primary btn-oper"  href="javascript:void(0);">编  辑</a>');h.push('      <a id="cannel_base_'+f+'" style="display:none;" class="btn btn-primary btn-oper"  href="javascript:void(0);">取  消</a>')}else{h.push('      <a id="add_base_'+f+'" class="btn btn-primary btn-oper"  href="javascript:void(0);">保  存</a>');h.push('      <a id="cannel_base_'+f+'" class="btn btn-primary btn-oper"  href="javascript:void(0);">取  消</a>')}
h.push('   </td>');h.push('</tr>');var m=$(g).attr('id');if(f=='edit'){$(g).parent().parent().after(h.join(''));queryUserRoles(m,f);$('#edit_base_'+f).unbind();$('#edit_base_'+f).click(function(){$(this).text('保  存');$('#cannel_base_'+f).show();replaceWithInput(f);$(this).unbind('click');$(this).click(function(){$('#cannel_base_'+f).hide();$(this).html('<img src="manager/images/common/spinner-mini.gif" />');var a='';var b='';var c='';var d='';$('#used_ul li a').each(function(){a+=$(this).attr('id')+','});if(a.indexOf(',')>0){a=a.substring(0,a.lastIndexOf(','))}
$("#function_tab input[type='checkbox']:checked").each(function(){b+=$(this).attr('menu_id')+','});if(b.indexOf(',')>0){b=b.substring(0,b.lastIndexOf(','))}
var e=$.trim($('#qx_functions').val());if(e!=undefined&&e!=null&&e!=''){c=$.trim($('#roleName_edit').val());d=$.trim($('#roleDesc_edit').val())}else{c=$.trim($('#roleName_edit').text());d=$.trim($('#roleDesc_edit').text())}
addOrUpdate(m,a,b,c,d,f)})});$('#cannel_base_'+f).unbind();$('#cannel_base_'+f).click(function(){$('#roleList_tab tr.trEditForm_com_edit').remove();$('#roleList_tab tr.tr_oper_button').remove();$('#roleList_tab img.comimg').attr('src','manager/images/common/open.png')});load_function_role(m)}else{$("#roleList_tab tr.addRows").after(h.join(""));queryUserRoles(null,f);replaceWithInput(f);load_function_role(null);$('#add_base_'+f).unbind();$('#add_base_'+f).click(function(){var a='';var b='';$('#used_ul li a').each(function(){a+=$(this).attr('id')+','});if(a.indexOf(',')>0){a=a.substring(0,a.lastIndexOf(','))}
$("#function_tab input[type='checkbox']:checked").each(function(){b+=$(this).attr('menu_id')+','});if(b.indexOf(',')>0){b=b.substring(0,b.lastIndexOf(','))}
addOrUpdate(null,a,b,$.trim($('#roleName_add').val()),$.trim($('#roleDesc_add').val()),f)});$('#cannel_base_'+f).unbind();$('#cannel_base_'+f).click(function(){$('#roleList_tab tr.trEditForm_com_add').remove();$('#roleList_tab tr.tr_oper_button').remove();$("#roleList_tab tr.addRows").remove()})}
$('#tab_selfs a.ui-tabs-anchor').click(function(){if(!$(this).hasClass('ui-tabs-active')){var p=$(this).parent();$('#tab_index_configs').find('li.ui-state-default').removeClass('ui-tabs-active').removeClass('ui-state-active');p.addClass('ui-tabs-active').addClass('ui-state-active');var a=$(this).attr('target');$('#tab_selfs').find('div.ui-tabs-panel').hide();$('#tab_selfs').find('#'+a).show()}})}
function replaceWithInput(a){var b=$.trim($('#qx_roles').val());var c=$.trim($('#qx_functions').val());if(b!=undefined&&b!=null&&b!=''){$('#tabs-equip_param_tb button').removeAttr("disabled");$('#noUsed_ul a').removeClass("disable");$('#noUsed_ul a').each(function(){$(this).removeClass("disable")});$('#used_ul a').removeClass("disable")}
if(c!=undefined&&c!=null&&c!=''){$('#roleList_tab').find('span.edit-text').each(function(i){if(i==0){$(this).replaceWith('<input type="text" id="'+$(this).attr('id')+'" value="'+$.trim($(this).text())+'" class="'+$(this).attr('class')+'" />')}else if(i==1){$(this).replaceWith('<textArea type="text" id="'+$(this).attr('id')+'">'+$.trim($(this).text())+'</textArea>')}});$("#function_tab input[type='checkbox']").removeAttr("disabled")}}
function changeType(a){$('#typeId').val($(a).val());$('#currentPage').val(1);document.myform.submit()}
function addOrUpdate(b,c,d,e,f,g){if(e!=null&&e!=undefined&&e!=''){var h={role_id:b,idStr:c,funStr:d,roleName:e,role_desc:f,flag:g};$.ajax({type:"POST",url:"role!updateRoleData.action",data:h,dataType:'json',cache:false,async:false,error:function(a){},success:function(a){if(a.resStr){alert('操作成功!');window.location.href='role!findRoles.action'}else{alert('操作失败')}}})}else{alert('角色名称不能为空！')}}
function queryUserRoles(e,f){var g={roleId:e};$('#used_ul').html('<img src="manager/ui/img/spinner-mini.gif" />');$('#noUsed_ul').html('<img src="manager/ui/img/spinner-mini.gif" />');$.ajax({type:"POST",url:"role!queryRoleUser.action",data:g,dataType:'json',cache:false,async:false,error:function(a){},success:function(a){$('#used_ul').html('');$('#noUsed_ul').html('');var b=a.used;var c=a.noUsed;if(b!=undefined&&b!=null&&b.length>0){var d='';for(var i=0;i<b.length;i++){d+='<li><a href="javascript:void(0);" id="'+b[i].seq+'" class="disable">'+b[i].username+'</a></li>'}
$('#used_ul').html(d)}
if(c!=undefined&&c!=null&&c.length>0){var d='';for(var i=0;i<c.length;i++){d+='<li><a href="javascript:void(0);" id="'+c[i].seq+'" class="disable">'+c[i].username+'</a></li>'}
$('#noUsed_ul').html(d)}
$('#used_ul a').click(function(){if(!$(this).hasClass('disable')){$('#used_ul li').removeClass('active');$(this).parent().addClass('active')}});$('#noUsed_ul a').click(function(){if(!$(this).hasClass('disable')){$('#noUsed_ul li').removeClass('active');$(this).parent().addClass('active')}});$('#used_ul a').dblclick(function(){if(!$(this).hasClass('disable')){$(this).unbind();$('#noUsed_ul li').removeClass('active');$('#noUsed_ul').append($(this).parent());reload_used_li()}});$('#noUsed_ul a').dblclick(function(){if(!$(this).hasClass('disable')){$(this).unbind();$('#used_ul li').removeClass('active');$('#used_ul').append($(this).parent());reload_noUsed_li()}});$('#btn_left_used').unbind().click(function(){if(!$(this).hasClass('disable')){$('#used_ul li').removeClass('active');$('#used_ul').append($('#noUsed_ul li.active'));reload_used_li()}});$('#btn_allLeft_used').unbind().click(function(){if(!$(this).hasClass('disable')){$('#used_ul li').removeClass('active');$('#used_ul').append($('#noUsed_ul li'));reload_used_li()}});$('#btn_allright_noused').unbind().click(function(){if(!$(this).hasClass('disable')){$('#noUsed_ul li').removeClass('active');$('#noUsed_ul').append($('#used_ul li'));reload_noUsed_li()}});$('#btn_right_used').unbind().click(function(){if(!$(this).hasClass('disable')){$('#noUsed_ul li').removeClass('active');$('#noUsed_ul').append($('#used_ul li.active'));reload_noUsed_li()}})}})}
function reload_noUsed_li(){$('#noUsed_ul a').unbind().dblclick(function(){if(!$(this).hasClass('disable')){$(this).unbind();$('#used_ul li').removeClass('active');$('#used_ul').append($(this).parent());reload_used_li()}}).click(function(){if(!$(this).hasClass('disable')){$('#noUsed_ul li').removeClass('active');$(this).parent().addClass('active')}})}
function reload_used_li(){$('#used_ul a').unbind().dblclick(function(){if(!$(this).hasClass('disable')){$(this).unbind();$('#noUsed_ul li').removeClass('active');$('#noUsed_ul').append($(this).parent());reload_noUsed_li()}}).click(function(){if(!$(this).hasClass('disable')){$('#used_ul li').removeClass('active');$(this).parent().addClass('active')}})}
function EditForm(){$('#roleList_tab img.comimg').unbind('click');$('#roleList_tab img.comimg').click(function(){$('#roleList_tab tr.addRows').next().remove();$('#roleList_tab tr.addRows').remove();$('#roleList_tab tr.tr_oper_button').remove();if($(this).attr('src')=='manager/images/common/close.png'){$(this).attr('src','manager/images/common/open.png');$('a.btn-config-com').unbind('click');$('a.btn-edit-com').unbind('click');$('a.btn-update-com').unbind('click');$('#roleList_tab tr.trEditForm_com_edit').remove()}else{$('#roleList_tab tr.trEditForm_com_edit').remove();$('#roleList_tab img.comimg').attr('src','manager/images/common/open.png');$(this).attr('src','manager/images/common/close.png');edit_basic_data("edit",this)}});$('#btn-com-add').click(function(){$('#roleList_tab img.comimg').attr('src','manager/images/common/open.png');$('#roleList_tab tr.trEditForm_com_edit').remove();$('#roleList_tab tr.tr_oper_button').remove();if(!$('#roleList_tab tr').hasClass('addRows')){edit_basic_data("add",null)}});$('#roleList_tab tr').click(function(){$('#roleList_tab tr').removeClass('success');if(!$(this).hasClass('success')){$(this).addClass('success')}});$('#btn-com-delete').click(function(){if($('#roleList_tab tr').hasClass('success')){var b=$('#roleList_tab tr.success').find('img.comimg').attr('id');if(b!=null&&b!=undefined&&b!=''){if(confirm("确定删除吗?")){var c={roleId:b};$.ajax({type:"POST",url:"role!deleteRoleInfo.action",data:c,dataType:'json',cache:false,async:false,error:function(a){},success:function(a){if(a.resStr){window.location.href='role!findRoles.action'}else{alert('操作失败')}}})}}}else{alert('请选中一行后再操作!')}})}
$(function(){EditForm();var a=$('#pageSum').val();var b=getOptionsFromForm();$("#PaginationCom").pagination(a,b)});function pageselectCallback(a,b){return false}
function getOptionsFromForm(){var a={callback:pageselectCallback};a['items_per_page']=0;a['num_display_entries']=5;a['num_edge_entries']=2;a['current_page']=parseInt($('#currentPage').val())-1;a['prev_text']='上一页';a['next_text']='下一页';a['callback_method']=callback_method_com;var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};$.each(b,function(k,v){a.prev_text=a.prev_text.replace(k,v);a.next_text=a.next_text.replace(k,v)});return a}
function callback_method_com(a){$('#currentPage').val(a);document.myform.submit()}
function load_function_role(c){var d={role_id:c};$.ajax({type:"POST",url:"role!queryRoleFunctionWithJson.action",data:d,dataType:'json',cache:false,async:false,error:function(a){},success:function(b){if(b.length>0){getTreeItem(b,'',0);$('#role_functions a.tree-node-ecicon').click(function(){var a=$(this).parent().attr('id');if($(this).hasClass('openStatus')){$(this).css('background-image','url(manager/ui/assets/img/collapse.gif)');$(this).next().find('span.tree-folder').css('background-image','url(manager/ui/assets/img/folder.gif)');$(this).removeClass('openStatus').addClass('closeStatus');nodeHide(a)}else{$(this).removeClass('closeStatus').addClass('openStatus');$(this).css('background-image','url(manager/ui/assets/img/expand.gif)');$(this).next().find('span.tree-folder').css('background-image','url(manager/ui/assets/img/folder-open.gif)');$(this).removeClass('closeStatus').addClass('openStatus');nodeShow(a)}})}}})}
function nodeHide(a){$('#role_functions tbody tr').find('div.tree-nodetitle').each(function(){if($(this).hasClass('tree-parentNode')&&$(this).attr('parentId')==a){if($(this).find('a.tree-node-ecicon').hasClass('openStatus')){nodeHide($(this).attr('id'))}
$(this).parent().parent().hide(300)}else if($(this).attr('parentId')==a){$(this).parent().parent().hide(300)}})}
function nodeShow(a){$('#role_functions tbody tr').find('div.tree-nodetitle').each(function(){if($(this).hasClass('tree-parentNode')&&$(this).attr('parentId')==a){if($(this).find('a.tree-node-ecicon').hasClass('openStatus')){nodeShow($(this).attr('id'))}
$(this).parent().parent().show(300)}else if($(this).attr('parentId')==a){$(this).parent().parent().show(300)}})}
function getTreeItem(a,b,c){var d='';var e=c==0?"":"display:none;"
if(a.length>0){for(var i=0;i<a.length;i++){if(a[i].children!=undefined&&a[i].children!=null&&a[i].children!=''){if(a[i].functions!=undefined&&a[i].functions!=null){d='<tr style="'+e+'"><td>';d+='   <div id="'+a[i].id+'" parentId="'+c+'" class="tree-nodetitle tree-expand tree-parentNode" title="">';d+=b;d+='     <a hidefocus="" parentId="'+c+'" onclick="return false;" href="javascript:void(0);" style="" class="tree-node-ecicon closeStatus"></a>';d+='       <span class="tree-nodeshow">';d+='         <span class="tree-folder tree-icon"></span>';d+='           <span class="tree-nodetext">'+a[i].text+'</span>';d+='       </span>';d+='   </div></td>';d+='<td>'
if(a[i].checked=="true"){d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'"  name="ck_'+a[i].id+'" checked="checked" disabled>查看</label>'}else{d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" disabled>查看</label>'}
d+=getFunction(a[i].functions);d+='</td></tr>'}else{d='<tr style="'+e+'"><td>';d+='   <div id="'+a[i].id+'" parentId="'+c+'"  class="tree-nodetitle tree-expand tree-parentNode" title="">';d+=b;d+='     <a hidefocus="" parentId="'+c+'" onclick="return false;" href="javascript:void(0);" style="" class="tree-node-ecicon closeStatus"></a>';d+='       <span class="tree-nodeshow">';d+='         <span class="tree-folder tree-icon"></span>';d+='           <span class="tree-nodetext">'+a[i].text+'</span>';d+='       </span>';d+='   </div></td>';d+='   <td>';if(a[i].checked=="true"){d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" checked="checked" disabled>查看</label>'}else{d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" disabled>查看</label>'}
d+='   </td>';d+='</tr>'}
$('#function_tab').append(d);var f=$('#'+a[i].id).find('span.tree-indent');var g='';if(f.length>0){for(var m=0;m<f.length+1;m++){g+='<span class="tree-indent" style=""></span>'}}else{g='<span class="tree-indent" style=""></span>'}
getTreeItem(a[i].children,g,a[i].id)}else{var f=$('#'+c).find('span.tree-indent');var g='';if(f.length>0){for(var m=0;m<f.length+1;m++){g+='<span class="tree-indent" style=""></span>'}}else{g='<span class="tree-indent" style=""></span>'}
if(a[i].functions!=undefined&&a[i].functions!=null){d='<tr style="'+e+'">';d+='   <td>';d+='       <div id="'+a[i].id+'" parentId="'+c+'"  class="tree-nodetitle " title="">';d+=g;d+='            <span class="tree-nodeshow">';d+='                 <span class="tree-leaf tree-icon"></span>';d+='                 <span class="tree-nodetext">'+a[i].text+'</span>';d+='            </span>';d+='       </div>';d+='   </td>';d+='   <td>';if(a[i].checked=="true"){d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" checked="checked" disabled>查看</label>'}else{d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" disabled>查看</label>'}
d+=getFunction(a[i].functions);d+='   </td>';d+='</tr>'}else{d='<tr style="'+e+'">';d+='   <td>';d+='       <div id="'+a[i].id+'" parentId="'+c+'"  class="tree-nodetitle " title="">';d+=g;d+='            <span class="tree-nodeshow">';d+='                 <span class="tree-leaf tree-icon"></span>';d+='                 <span class="tree-nodetext">'+a[i].text+'</span>';d+='            </span>';d+='       </div>';d+='   </td>';d+='   <td>';if(a[i].checked=="true"){d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" checked="checked" disabled>查看</label>'}else{d+='       <label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" disabled>查看</label>'}
d+='   </td>';d+='</tr>'}
$('#function_tab').append(d)}}}}
function getFunction(a){var b='';if(a.length>0){for(var i=0;i<a.length;i++){if(a[i].checked=="true"){b+='<label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" checked="checked" disabled/>'+a[i].text+'</label>'}else{b+='<label class="function-item"><input type="checkbox" id="ck_'+a[i].id+'" menu_id="'+a[i].menu_code+'" name="ck_'+a[i].id+'" disabled />'+a[i].text+'</label>'}}}
return b}